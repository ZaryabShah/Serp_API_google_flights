<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Flights URL Generator - Test Form</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1a73e8;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #1a73e8;
        }
        
        .row {
            display: flex;
            gap: 15px;
        }
        
        .row .form-group {
            flex: 1;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .button {
            background: #1a73e8;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        
        .button:hover {
            background: #1557b0;
        }
        
        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #1a73e8;
        }
        
        .result h3 {
            margin-top: 0;
            color: #1a73e8;
        }
        
        .url-output {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            font-family: monospace;
            font-size: 14px;
            word-break: break-all;
            line-height: 1.4;
        }
        
        .copy-button {
            background: #34a853;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .copy-button:hover {
            background: #2d8f40;
        }
        
        .test-button {
            background: #ea4335;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .test-button:hover {
            background: #d33b2c;
        }
        
        .error {
            background: #fdf2f2;
            color: #d93025;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #d93025;
            margin-top: 20px;
        }
        
        .info {
            background: #e8f0fe;
            color: #1a73e8;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ›« Google Flights URL Generator</h1>
        
        <div class="info">
            <strong>ðŸ“‹ Instructions:</strong> Fill out the form below to generate a Google Flights URL. 
            This tool creates the modern <code>tfs</code> format URLs that Google Flights uses internally.
        </div>
        
        <form id="flightForm">
            <!-- Trip Type -->
            <div class="form-group">
                <label for="tripType">Trip Type</label>
                <select id="tripType" name="tripType">
                    <option value="oneway">One-way</option>
                    <option value="roundtrip" selected>Round-trip</option>
                </select>
            </div>
            
            <!-- Route -->
            <div class="row">
                <div class="form-group">
                    <label for="origin">From (Airport Code)</label>
                    <input type="text" id="origin" name="origin" value="LAX" placeholder="e.g., LAX, JFK, SYD" required>
                </div>
                <div class="form-group">
                    <label for="destination">To (Airport Code)</label>
                    <input type="text" id="destination" name="destination" value="JFK" placeholder="e.g., LAX, JFK, SYD" required>
                </div>
            </div>
            
            <!-- Dates -->
            <div class="row">
                <div class="form-group">
                    <label for="departDate">Departure Date</label>
                    <input type="date" id="departDate" name="departDate" required>
                </div>
                <div class="form-group" id="returnDateGroup">
                    <label for="returnDate">Return Date</label>
                    <input type="date" id="returnDate" name="returnDate">
                </div>
            </div>
            
            <!-- Passengers -->
            <div class="row">
                <div class="form-group">
                    <label for="adults">Adults</label>
                    <input type="number" id="adults" name="adults" value="1" min="1" max="9" required>
                </div>
                <div class="form-group">
                    <label for="children">Children (2-11)</label>
                    <input type="number" id="children" name="children" value="0" min="0" max="8">
                </div>
                <div class="form-group">
                    <label for="infantsSeat">Infants (in seat)</label>
                    <input type="number" id="infantsSeat" name="infantsSeat" value="0" min="0" max="8">
                </div>
                <div class="form-group">
                    <label for="infantsLap">Infants (on lap)</label>
                    <input type="number" id="infantsLap" name="infantsLap" value="0" min="0" max="8">
                </div>
            </div>
            
            <!-- Cabin and Preferences -->
            <div class="row">
                <div class="form-group">
                    <label for="cabin">Cabin Class</label>
                    <select id="cabin" name="cabin">
                        <option value="ECONOMY" selected>Economy</option>
                        <option value="PREMIUM_ECONOMY">Premium Economy</option>
                        <option value="BUSINESS">Business</option>
                        <option value="FIRST">First Class</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="stops">Stops</label>
                    <select id="stops" name="stops">
                        <option value="ANY" selected>Any number of stops</option>
                        <option value="NONSTOP">Nonstop only</option>
                        <option value="MAX_1">1 stop or fewer</option>
                        <option value="MAX_2">2 stops or fewer</option>
                    </select>
                </div>
            </div>
            
            <!-- Airlines -->
            <div class="form-group">
                <label for="includeAirlines">Include Airlines (comma-separated)</label>
                <input type="text" id="includeAirlines" name="includeAirlines" placeholder="e.g., AA,DL,UA">
            </div>
            
            <div class="form-group">
                <label for="excludeAirlines">Exclude Airlines (comma-separated)</label>
                <input type="text" id="excludeAirlines" name="excludeAirlines" placeholder="e.g., NK,F9">
            </div>
            
            <!-- Time Windows -->
            <div class="row">
                <div class="form-group">
                    <label for="depTimeStart">Departure Time (earliest)</label>
                    <input type="time" id="depTimeStart" name="depTimeStart">
                </div>
                <div class="form-group">
                    <label for="depTimeEnd">Departure Time (latest)</label>
                    <input type="time" id="depTimeEnd" name="depTimeEnd">
                </div>
            </div>
            
            <!-- Localization -->
            <div class="row">
                <div class="form-group">
                    <label for="language">Language</label>
                    <select id="language" name="language">
                        <option value="en" selected>English</option>
                        <option value="es">Spanish</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                        <option value="ja">Japanese</option>
                        <option value="zh">Chinese</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="country">Country</label>
                    <select id="country" name="country">
                        <option value="US" selected>United States</option>
                        <option value="CA">Canada</option>
                        <option value="GB">United Kingdom</option>
                        <option value="AU">Australia</option>
                        <option value="DE">Germany</option>
                        <option value="FR">France</option>
                        <option value="JP">Japan</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="currency">Currency</label>
                    <select id="currency" name="currency">
                        <option value="USD" selected>USD</option>
                        <option value="CAD">CAD</option>
                        <option value="GBP">GBP</option>
                        <option value="AUD">AUD</option>
                        <option value="EUR">EUR</option>
                        <option value="JPY">JPY</option>
                    </select>
                </div>
            </div>
            
            <button type="submit" class="button">Generate Google Flights URL</button>
        </form>
        
        <div id="result" class="result" style="display: none;">
            <h3>Generated URL</h3>
            <div id="urlOutput" class="url-output"></div>
            <button id="copyButton" class="copy-button">Copy URL</button>
            <button id="testButton" class="test-button">Open in New Tab</button>
        </div>
        
        <div id="error" class="error" style="display: none;"></div>
    </div>

    <script>
        // Set default departure date to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('departDate').value = tomorrow.toISOString().split('T')[0];
        
        // Set default return date to 7 days from departure
        const returnDate = new Date(tomorrow);
        returnDate.setDate(returnDate.getDate() + 7);
        document.getElementById('returnDate').value = returnDate.toISOString().split('T')[0];
        
        // Show/hide return date based on trip type
        document.getElementById('tripType').addEventListener('change', function() {
            const returnDateGroup = document.getElementById('returnDateGroup');
            if (this.value === 'oneway') {
                returnDateGroup.style.display = 'none';
                document.getElementById('returnDate').required = false;
            } else {
                returnDateGroup.style.display = 'block';
                document.getElementById('returnDate').required = true;
            }
        });
        
        // Form submission
        document.getElementById('flightForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const formData = new FormData(this);
                const data = Object.fromEntries(formData.entries());
                
                // Build the URL (simplified client-side version)
                const url = buildGoogleFlightsURL(data);
                
                // Show result
                document.getElementById('urlOutput').textContent = url;
                document.getElementById('result').style.display = 'block';
                document.getElementById('error').style.display = 'none';
                
            } catch (error) {
                document.getElementById('error').textContent = 'Error: ' + error.message;
                document.getElementById('error').style.display = 'block';
                document.getElementById('result').style.display = 'none';
            }
        });
        
        // Copy button
        document.getElementById('copyButton').addEventListener('click', function() {
            const url = document.getElementById('urlOutput').textContent;
            navigator.clipboard.writeText(url).then(function() {
                this.textContent = 'Copied!';
                setTimeout(() => {
                    this.textContent = 'Copy URL';
                }, 2000);
            }.bind(this));
        });
        
        // Test button
        document.getElementById('testButton').addEventListener('click', function() {
            const url = document.getElementById('urlOutput').textContent;
            window.open(url, '_blank');
        });
        
        function buildGoogleFlightsURL(data) {
            // This is a simplified client-side version
            // In production, you'd call your Python backend
            
            // Basic validation
            if (!data.origin || !data.destination || !data.departDate) {
                throw new Error('Origin, destination, and departure date are required');
            }
            
            // Build a simplified URL (this would normally use the Python library)
            let url = 'https://www.google.com/travel/flights/search?tfs=';
            
            // Create a simplified payload structure
            const legs = [{
                from: data.origin.toUpperCase(),
                to: data.destination.toUpperCase(),
                date: data.departDate
            }];
            
            if (data.tripType === 'roundtrip' && data.returnDate) {
                legs.push({
                    from: data.destination.toUpperCase(),
                    to: data.origin.toUpperCase(),
                    date: data.returnDate
                });
            }
            
            const payload = {
                legs: legs,
                passengers: {
                    adults: parseInt(data.adults) || 1,
                    children: parseInt(data.children) || 0,
                    infants_seat: parseInt(data.infantsSeat) || 0,
                    infants_lap: parseInt(data.infantsLap) || 0
                },
                cabin: data.cabin || 'ECONOMY',
                stops: data.stops || 'ANY'
            };
            
            // Simple base64 encoding (in production, use the Python library)
            const payloadStr = JSON.stringify(payload);
            const encodedPayload = btoa(payloadStr).replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
            
            url += encodedPayload;
            url += `&hl=${data.language || 'en'}`;
            url += `&gl=${data.country || 'US'}`;
            url += `&curr=${data.currency || 'USD'}`;
            
            return url;
        }
    </script>
</body>
</html>
